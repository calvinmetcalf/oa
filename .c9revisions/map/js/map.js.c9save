{"ts":1340972703244,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var m;\nvar baseid = 1632887;\nvar oaid = 3145994;\nvar geocoder = new google.maps.Geocoder();\nvar zoom = 8;\nvar center = new google.maps.LatLng(42.04113400940814,-71.795654296875);\nvar marker;\nvar mainLayer;\n\n$(function() {\n        $( \"#tabs\" ).tabs({\n        \tcollapsible: true,\n            selected: -1\n\t\t});\n        $( \"input:submit,input:reset\" ).button();\n        $('input, textarea').placeholder();\n        fusion();\n        popLists();\n\t});\n\nfunction fusion() {\n    \n  m = new google.maps.Map(document.getElementById('map'), {\n      center: center,\n      zoom: zoom,\n      mapTypeId: 'roadmap'\n    });\n\nvar baseLayer = new google.maps.FusionTablesLayer(baseid);\n  baseLayer.setQuery(\"SELECT 'geometry' FROM \" + baseid);\n  baseLayer.setMap(m);\n  baseLayer.setOptions({suppressInfoWindows:true});\n  \n mainLayer = new google.maps.FusionTablesLayer(oaid);\n  mainLayer.setQuery(\"SELECT 'point' FROM \" + oaid + \" WHERE 'Status' = 'Active'\");\n  mainLayer.setMap(m);\n  }\n\nfunction geocode() {\n     var address = document.getElementById(\"address\").value;\n    geocoder.geocode( { 'address': address}, function(results, status) {\n      if (status == google.maps.GeocoderStatus.OK) {\n        m.setCenter(results[0].geometry.location);\n        m.setZoom(14);\n     marker = new google.maps.Marker({\n            map: m, \n            position: results[0].geometry.location\n        });\n      } else {\n        alert(\"Geocode was not successful for the following reason: \" + status);\n      }\n    });\n}\n\nfunction resetgeo() {\n    \n    m.setCenter(center);\n    m.setZoom(zoom);\nmarker.setMap(null);\n}\n\n \n    \n    google.load('visualization', '1', {});\n    \nfunction popLists(){    \n    MakePopList('SignType',getSignData);\n    MakePopList('PermitHoldersName',getHolderData);\n    MakePopList('SignCity',getMuniData);\n}\n\nfunction MakePopList(columnName,callfunc){\n var queryText = encodeURIComponent(\"SELECT \" +columnName + \", COUNT() FROM \" + oaid + \" GROUP BY \" +columnName);\n    var query = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq='  + queryText);\n\tquery.send(callfunc);\n\t}\n\nvar getSignData = MakeData(\"signType\",\" AND 'SignType' like '\")\nvar getHolderData = MakeData(\"holderName\",\" AND 'PermitHoldersName' like '\")\nvar getMuniData = MakeData(\"cityTown\",\" AND 'SignCity' like '\")\n\nfunction MakeData(selectID,querryText){\n\nfunction getData(response) {\n  // Get the number of rows\nvar numRows = response.getDataTable().getNumberOfRows();\n  \n  // Add options to the select menu based on the results\n var typeSelect = document.getElementById(selectID);  \n  for(i = 0; i < numRows; i++) {\n      var ftData = response.getDataTable().getValue(i, 0);\n      if (!ftData)\n     { continue;}\n     else if\n     (String(ftData).indexOf(\",\")>-1)\n     {continue;}\n     else\n     { var newoption = document.createElement('option');\n      newoption.setAttribute('value',querryText + ftData + \"'\");\n    newoption.innerHTML = ftData;\n    typeSelect.appendChild(newoption);}\n  }  \n}\nreturn getData;\n}\n\n\n\nfunction changeMap() {\n  var signType = document.getElementById('signType').value.replace(\"'\", \"\\\\'\");\n  var holderName = document.getElementById('holderName').value.replace(\"'\", \"\\\\'\");\n  var cityTown = document.getElementById('cityTown').value.replace(\"'\", \"\\\\'\");\n  mainLayer.setQuery(\"SELECT 'point' FROM \" + oaid + \" WHERE 'Status' = 'Active' \" + signType + holderName + cityTown);\n \n}\n\n\nfunction lookupPermit() {\n  var permitNum = document.getElementById('permitNumber').value.replace(\"'\", \"\\\\'\");\n  mainLayer.setQuery(\"SELECT 'point' FROM \" + oaid + \" WHERE 'PermitNumber' = '\" + permitNum + \"'\");\n  var centerQueryText = encodeURIComponent(\"SELECT 'Latitude', 'Longitude' FROM \" + oaid + \" WHERE 'PermitNumber' = '\" + permitNum + \"'\");\n /*I have no idea why \"'PermitNumber' = \" works here but \"'PermitNumber' CONTAINS\" does not*/\n var centerQuery = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq='  + centerQueryText);\n  centerQuery.send(zoomTo);\n}\n\nfunction zoomTo(response) {\n\nif (!response) {\n  alert('no response');\n  return;\n}\n\nif (response.isError()) {\n  alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());\n  return;\n} \n\n\n\nm.setCenter(new google.maps.LatLng(\n\n          parseFloat(response.getDataTable().getValue(0, 0)),\n\n          parseFloat(response.getDataTable().getValue(0, 1))\n\n));\n\nm.setZoom(14);\n\n}\n\nfunction resetPermit(){\n      m.setCenter(center);\n    m.setZoom(zoom);\n    changeMap();\n    \n}\n"]],"start1":0,"start2":0,"length1":0,"length2":4495}]],"length":4495}
